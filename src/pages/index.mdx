import HomePage from '../components/HomePage/HomePage';
import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';

export const getStaticProps = () => {
  const NOTE_DIRECTORIES = ['fleeting-notes', 'literature-notes', 'permanent-notes'];
  const pagesDir = path.join(process.cwd(), 'src', 'pages');
  const allNotes = [];

  NOTE_DIRECTORIES.forEach(dirName => {
    const dirPath = path.join(pagesDir, dirName);
    try {
      const files = fs.readdirSync(dirPath).filter(f => f.endsWith('.mdx') || f.endsWith('.md'));
      files.forEach(file => {
        const filePath = path.join(dirPath, file);
        const content = fs.readFileSync(filePath, 'utf8');
        const { data: frontmatter } = matter(content);
        const filename = file.replace(/\.mdx?$/, '');

        const title = frontmatter.title || filename.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
        const date = frontmatter.date || new Date().toISOString().split('T')[0];
        const description = frontmatter.description || '';

        allNotes.push({
          title,
          path: `/${dirName}/${filename}`,
          category: dirName.split('-').map(w => w[0].toUpperCase() + w.slice(1)).join(' '),
          date,
          description
        });
      });
    } catch {}
  });

  return {
    props: {
      allNotes: allNotes.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
    }
  };
};

export default HomePage;
